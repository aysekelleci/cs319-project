{% extends 'accounts/navbar.html' %}
{% load crispy_forms_tags %}

{% block header_content %}
<div class="header">Add Courses</div>
{% endblock %}

{% block page_content %}
<div class="page_content">
    <div class="courses_taken">
        <h2>Current Courses Taken</h2>
        <div id= "course_div">
            <table class="sortable" id="taken_courses_table" style="table-layout:fixed; width: 100%">
                <thead>
                <tr>
                    <th style="width:4%" class="sorttable_nosort"></th>
                    <th style="width:10%">Course Code</th>
                    <th style="width:20%">Course Name</th>
                    <th style="width:7%">Credits</th>
                    <th style="width:20%">Course Type</th>
                    <th style="width:7%">Credits</th>
                    <th style="width:20%">Course Code and Name</th>
                    <th style="width:10%">Status</th>
                    <th style="width:12%" class="sorttable_nosort">Operation</th>
                </tr>
                </thead>
                <tbody>
                {% for user_course in user_unmerged_courses %}
                <tr>
                    <td id="count"></td>
                    <td>{{user_course.course.code}}</td>
                    <td>{{user_course.course.course_name}}</td>
                    <td>{{user_course.course.course_credit}}</td>

                    {% if user_course.course.bilkent_equivalent.course_type == MUST_COURSE %}
                    <td>Must Course</td>
                    <td>{{user_course.course.bilkent_equivalent.course_credit}}</td>
                    <td>{{user_course.course.bilkent_equivalent.course_code}}: {{user_course.course.bilkent_equivalent.course_name}}</td>

                    {% else %}
                    <td>{{user_course.course.bilkent_equivalent.elective_group_name}}</td>
                    <td>{{user_course.course.bilkent_equivalent.course_credit}}</td>
                    <td>{{user_course.course.bilkent_equivalent.course_code}}: {{user_course.course.bilkent_equivalent.course_name}}</td>
                    {% endif %}

                    <td>
                        {% if user_course.course.approved %}
                        Approved
                        {% elif user_course.course.is_rejected %}
                        Rejected
                        {% elif user_course.submitted %}
                        Waiting for Approval
                        {% else %}
                        <a class="button" style="display: flex"href="/submit-course/{{user_course.course.pk}}">Submit for Approval</a>
                        {% endif %}
                    </td>

                    <td>
                        <a class="button" href="/remove-from-courses/{{user_course.course.pk}}">Remove</a>
                        <input type="checkbox" class="merge-course-selection" id="{{user_course.course.pk}}">
                    </td>
                </tr>
                {%endfor%}


                {% for courseKey, courseList in user_merged_course_dict.items %}
                {% for user_course in courseList %}
                <tr>
                    <td id="count"></td>
                    <td>{{user_course.course.code}}</td>
                    <td>{{user_course.course.course_name}}</td>
                    <td>{{user_course.course.course_credit}}</td>

                    {% if courseList.0 is user_course %}

                    {% if courseKey.bilkent_equivalent.course_type == MUST_COURSE %}
                    <td rowspan="2">Must Course</td>
                    <td rowspan="2">{{courseKey.bilkent_equivalent.course_credit}}</td>
                    <td rowspan="2">{{courseKey.bilkent_equivalent.course_code}}: {{courseKey.bilkent_equivalent.course_name}}</td>

                    {% else %}
                    <td rowspan="2">{{courseKey.bilkent_equivalent.elective_group_name}}</td>
                    <td rowspan="2">{{courseKey.bilkent_equivalent.course_credit}}</td>
                    <td rowspan="2">{{courseKey.bilkent_equivalent.course_code}}: {{courseKey.bilkent_equivalent.course_name}}</td>
                    {% endif %}


                    <td rowspan="2">
                        {% if courseKey.approved %}
                        Approved
                        {% elif courseKey.is_rejected %}
                        Rejected
                        {% elif courseKey.submitted %}
                        Waiting for Approval
                        {% else %}
                        <a class="button" style="display: flex"href="/submit-course/{{courseKey.pk}}">Submit for Approval</a>
                        {% endif %}
                    </td>


                    <td rowspan="2">
                        <a class="button" href="/remove-from-courses/{{courseKey.pk}}">Remove</a>
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
                {% endfor %}
                </tbody>
                <tfoot>
                <tr>
                    <td colspan="8">ECTS Total: {{total_ects_credit}}</td>
                    <td><a class="button" onclick="mergeCourses()" href="#">Merge</a></td>
                </tr>
                </tfoot>
            </table>
        </div>
        <div style="padding: 0; display: flex; justify-content: right;">
            <a style="margin-right: 20px; margin-left: auto;" class="final-list" href="#">Submit Final List</a>
        </div>
    </div>
    <div class="add_course">

        <h2>Add Course</h2>
        <div class="buttons">
            <button type="button" onclick="toggleButtons(this, 1)" id="1">Add Pre-Approved Course</button>
            <button type="button" onclick="location.href = '../../add-unapproved-course/'">Add New Course</button>
            <button type="button" onclick="location.href = '../../add-bilkent-course/'">Add Bilkent Equivalent Course</button>
            <button type="button" onclick="location.href = '../../create-document/'">Create Document</button>
        </div>


        <div hidden="hidden" id="toggle-element-1">
            <input type="text" id="filter_input" onkeyup="filterTable()" style="width:100%" placeholder="Search for courses..">
            <div style="height:300px;overflow:auto;">
                <table class="sortable" id="filtered_list" style="width:100%;">

                    <thead>
                    <tr>
                        <th style="width:6%" class="sorttable_nosort">Count</th>
                        <th style="width:10%">{{student.university}} Course Code</th>
                        <th style="width:20%">{{student.university}} Course Name</th>
                        <th style="width:7%">Credits</th>
                        <th style="width:20%">Bilkent University Equivalent Course Type</th>
                        <th style="width:7%">Credits</th>
                        <th style="width:20%">Bilkent University Equivalent Course Code and Name</th>
                        <th style="width:10%" class="sorttable_nosort">Operation</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for course in approved_unmerged_courses %}
                    <tr>
                        <td id="count"></td>
                        <td>{{course.code}}</td>
                        <td>{{course.course_name}}</td>
                        <td>{{course.course_credit}}</td>

                        {% if course.bilkent_equivalent.course_type == MUST_COURSE %}
                        <td>Must Course</td>
                        <td>{{course.bilkent_equivalent.course_credit}}</td>
                        <td>{{course.bilkent_equivalent.course_code}}: {{course.bilkent_equivalent.course_name}}</td>

                        {% else %}
                        <td>{{course.bilkent_equivalent.elective_group_name}}</td>
                        <td>{{course.bilkent_equivalent.course_credit}}</td>
                        <td>{{course.bilkent_equivalent.course_code}}: {{course.bilkent_equivalent.course_name}}</td>
                        {% endif %}

                        <td><a class="button" href="/add-to-courses/{{course.pk}}">Add</a></td>
                    </tr>
                    {%endfor%}
                    {% for courseKey, courseList in approved_merged_course_dict.items %}
                    {% for course in courseList %}
                    {% if courseKey.approved %}
                    <tr>
                        <td id="count"></td>
                        <td>{{course.code}}</td>
                        <td>{{course.course_name}}</td>
                        <td>{{course.course_credit}}</td>

                        {% if courseList.0 is course %}
                        {% if courseKey.bilkent_equivalent.course_type == MUST_COURSE %}
                        <td rowspan="2">Must Course</td>
                        <td rowspan="2">{{course.bilkent_equivalent.course_credit}}</td>
                        <td rowspan="2">{{course.bilkent_equivalent.course_code}}: {{course.bilkent_equivalent.course_name}}</td>

                        {% else %}
                        <td rowspan="2">{{course.bilkent_equivalent.elective_group_name}}</td>
                        <td rowspan="2">{{course.bilkent_equivalent.course_credit}}</td>
                        <td rowspan="2">{{course.bilkent_equivalent.course_code}}: {{course.bilkent_equivalent.course_name}}</td>
                        {% endif %}
                        <td rowspan="2"><a class="button" href="/add-to-courses/{{course.pk}}">Add</a></td>
                        {% endif %}
                    </tr>
                    {% endif %}
                    {% endfor %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

